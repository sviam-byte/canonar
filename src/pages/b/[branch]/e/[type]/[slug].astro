---
export const prerender = true;
import Layout from "@/layouts/Base.astro";
import EntityPanel from "@/components/EntityPanel";

export async function getStaticPaths() {
  const files = import.meta.glob("/content/cards/*/*/*.meta.json", {
    eager: true,
    import: "default",
  }) as Record<string, any>;

  const regMap = import.meta.glob("/content/registry.json", {
    eager: true,
    import: "default",
  }) as Record<string, any>;
  const registry = regMap["/content/registry.json"] ?? {};

  const out: any[] = [];
  for (const [p, meta] of Object.entries(files)) {
    const m = p.match(/^\/content\/cards\/([^/]+)\/([^/]+)\/([^/]+)\.meta\.json$/);
    if (!m) continue;
    const [, branch, type, slug] = m;
    out.push({ params: { branch, type, slug }, props: { meta, branch, type, slug, registry } });
  }
  return out;
}

const { meta, branch, type, slug, registry } = Astro.props;
const viewTypePlural = type.endsWith("s") ? type : `${type}s`;
---

<Layout title={`E Â· ${meta?.title ?? slug}`}>
  <EntityPanel branch={branch} viewType={viewTypePlural} meta={meta} registry={registry} />
</Layout>
