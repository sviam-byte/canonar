---
// src/pages/b/[branch]/e/[type]/[slug].astro
import "~/styles/global.css";
import EntityPanel from "@/components/EntityPanel";
import registry from "@/data/models/registry.json";

export async function getStaticPaths() {
  const { default: idx } = await import("@/data/index.json");

  const importMeta = (e) =>
    import(`@/data/b/${e.branch}/e/${e.type}/${e.meta.slug}.meta.json`);

  const paths = await Promise.all(
    idx.entries.map(async (e) => {
      const { default: meta } = await importMeta(e);
      return {
        params: { branch: e.branch, type: e.type, slug: e.meta.slug },
        props: { branch: e.branch, type: e.type, meta }
      };
    })
  );

  return paths;
}

const { branch, type, meta } = Astro.props;
---

<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <title>{meta.title}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <EntityPanel
      branch={branch}
      viewType={type}   /* plural */
      meta={meta}
      registry={registry}
      client:load
    />
  </body>
</html>
