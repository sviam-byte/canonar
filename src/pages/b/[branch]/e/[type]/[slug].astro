---
import "~/styles/global.css";
import EntityPanel from "@/components/EntityPanel";
import registry from "@/data/models/registry.json";

export async function getStaticPaths() {
  const { default: idx } = await import("@/data/index.json");
  const paths = idx.entries.map((e) => ({
    params: { branch: e.branch, type: e.type, slug: e.meta.slug },
    props: {
      branch: e.branch,
      type: e.type,
      meta: e.meta,
    },
  }));
  return paths;
}

// нормализация мн. → ед.
const normType = (t: string) =>
  t === "characters" ? "character" : t === "objects" ? "object" : t;

const { branch, type, meta } = Astro.props;
const modelKey = normType(type);
---

<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <title>{meta.title}</title>
  </head>
  <body>
    <EntityPanel
      branch={branch}
      type={modelKey}
      meta={meta}
      registry={registry}
    />
  </body>
</html>
