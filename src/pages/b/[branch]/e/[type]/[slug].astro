---
export const prerender = true;

import Layout from "@/layouts/Base.astro";
import EntityPanel from "@/components/EntityPanel";
import registry from "@/data/models/registry.json";

// Читаем предсобранные .meta.json из src/data
const metas = import.meta.glob("/src/data/b/*/e/*/*.meta.json", {
  eager: true,
  import: "default",
}) as Record<string, any>;

export async function getStaticPaths() {
  const out: Array<{ params: { branch: string; type: string; slug: string }, props: any }> = [];
  for (const [p, meta] of Object.entries(metas)) {
    const m = p.match(/^\/src\/data\/b\/([^/]+)\/e\/([^/]+)\/([^/]+)\.meta\.json$/);
    if (!m) continue;
    const [, branch, type, slug] = m;
    out.push({ params: { branch, type, slug }, props: { branch, type, slug, meta, registry } });
  }
  return out;
}

const { meta, branch, type, slug } = Astro.props;
const viewType = type; // уже во множественном числе в структуре папок
---

<Layout title={`E · ${meta?.title ?? slug}`}>
  <EntityPanel branch={branch} viewType={viewType} meta={meta} registry={registry} />
</Layout>
